# SPECTRUM KERNEL MANAGER
# Ramdisk file for profile based kernel management

# Initialization
on property:init.svc.qcom-post-boot=stopped
    # Set default profile on first boot
    exec u:r:init:s0 root root -- /init.spectrum.sh
    exec u:r:su:s0 root root -- /init.spectrum.sh
    # Enable Spectrum support
    setprop spectrum.support 1
    # Add kernel name
    setprop persist.spectrum.kernel Genom

# Balanced 
on property:persist.spectrum.profile=0 && property:init.svc.qcom-post-boot=stopped

    # Init
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    # write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "pwrutilx"
    write /sys/module/cpu_boost/parameters/input_boost_enabled "0"
    write /sys/module/cpu_boost/parameters/input_boost_freq "0:1113600 1:0 2:0 3:0 4:1113600 5:0 6:0 7:0"
    write /sys/module/cpu_boost/parameters/input_boost_ms "350"

    write /dev/cpuset/foreground/cpus 0-2,4-7
    write /dev/cpuset/foreground/boost/cpus 4-7
    write /dev/cpuset/top-app/cpus 0-7


    # Fallback to CFQ
    write /sys/block/mmcblk0/queue/scheduler "cfq"
    write /sys/block/mmcblk1/queue/scheduler "cfq"

    # GPU
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor "msm-adreno-tz"
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq "133000000"
    write /sys/class/kgsl/kgsl-3d0/max_gpuclk "725000000"
    write /sys/module/msm_performance/parameters/touchboost "0"
    write /sys/module/adreno_idler/parameters/adreno_idler_active "Y"
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost "0"

# Performance
on property:persist.spectrum.profile=1
  
    # Init
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    # write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"
 
    # CPU
    # write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 500
    # write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 20000
    # write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable 1

    write /sys/module/cpu_boost/parameters/input_boost_enabled "0"
    write /sys/module/cpu_boost/parameters/input_boost_freq "0:1113600 1:0 2:0 3:0 4:1113600 5:0 6:0 7:0"
    write /sys/module/cpu_boost/parameters/input_boost_ms "350"

    # Use BFQ for Gaming and Performance profile
    write /sys/block/mmcblk0/queue/scheduler "bfq"
    write /sys/block/mmcblk1/queue/scheduler "bfq"

    write /dev/cpuset/foreground/cpus 0-2,4-7
    write /dev/cpuset/foreground/boost/cpus 4-7
    write /dev/cpuset/top-app/cpus 0-7

    # GPU
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor "msm-adreno-tz"
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq "320000000"
    write /sys/class/kgsl/kgsl-3d0/max_gpuclk "725000000"
    write /sys/module/adreno_idler/parameters/adreno_idler_active "Y"
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost "0"
    write /sys/module/msm_performance/parameters/touchboost "0"


# Battery
on property:persist.spectrum.profile=2 && property:init.svc.qcom-post-boot=stopped

    # Init
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    # write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "pwrutilx"
    write /sys/module/cpu_boost/parameters/input_boost_enabled "0"
    write /sys/module/cpu_boost/parameters/input_boost_freq "0:1113600 1:0 2:0 3:0 4:1113600 5:0 6:0 7:0"
    write /sys/module/cpu_boost/parameters/input_boost_ms "350"
    write /dev/cpuset/foreground/cpus 0-2,4-5
    write /dev/cpuset/foreground/boost/cpus 4-5
    write /dev/cpuset/top-app/cpus 0-5

    # Fallback to CFQ
    write /sys/block/mmcblk0/queue/scheduler "cfq"
    write /sys/block/mmcblk1/queue/scheduler "cfq"

    # GPU
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor "msm-adreno-tz"
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq "133000000"
    write /sys/class/kgsl/kgsl-3d0/max_gpuclk "510000000"
    write /sys/module/adreno_idler/parameters/adreno_idler_active "Y"
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost "0"
    write /sys/module/msm_performance/parameters/touchboost "0"

# Gaming
on property:persist.spectrum.profile=3

    # CPU
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    # write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"

    # CPU
    # write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 500
    # write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 20000
    # write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable 1
    write /sys/module/cpu_boost/parameters/input_boost_enabled "1"
    write /sys/module/cpu_boost/parameters/input_boost_freq "0:1113600 1:0 2:0 3:0 4:1113600 5:0 6:0 7:0"
    write /sys/module/cpu_boost/parameters/input_boost_ms "350"
    write /dev/cpuset/foreground/cpus 0-2,4-7
    write /dev/cpuset/foreground/boost/cpus 4-7
    write /dev/cpuset/top-app/cpus 0-7

    # Use BFQ for Gaming and Performance profile
    write /sys/block/mmcblk0/queue/scheduler "bfq"
    write /sys/block/mmcblk1/queue/scheduler "bfq"

    # GPU
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor "msm-adreno-tz"
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq "320000000"
    write /sys/class/kgsl/kgsl-3d0/max_gpuclk "725000000"
    write /sys/module/adreno_idler/parameters/adreno_idler_active "N"
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost "3"
    write /sys/module/msm_performance/parameters/touchboost "1"

    